<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.6"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Apache Log4cxx: Threading</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="customdoxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">Apache Log4cxx<span id="projectnumber">&#160;Version 1.1.0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.6 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('threading.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Threading </div></div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#unexpected-exit">Unexpected Exit</a></li>
<li class="level1"><a href="#signal-handling">Signal Handling with Log4cxx</a><ul><li class="level2"><a href="#configuring">Configuring Thread</a></li>
</ul>
</li>
</ul>
</div>
<div class="textblock"><p><a class="anchor" id="md_src_site_markdown_threading"></a></p>
<p>Log4cxx is designed to be thread-safe under under normal usage. This means that logging itself is always thread-safe, however there are certain circumstances that can cause threading issues with Log4cxx.</p>
<h1><a class="anchor" id="unexpected-exit"></a>
Unexpected Exit</h1>
<p>In multithreaded applications, it is possible to call <code>exit()</code> from any thread in the application. When this happens, other threads in the application may continue to run and attempt to log information. As of version 12 of Log4cxx, this should not cause the library to crash.</p>
<p>We recommend that a graceful exit be performed whenever possible, and that all threads be terminated properly before returning from <code>main()</code>.</p>
<p>See <a href="https://issues.apache.org/jira/browse/LOGCXX-322">LOGCXX-322</a> for more information.</p>
<h1><a class="anchor" id="signal-handling"></a>
Signal Handling with Log4cxx</h1>
<p>Under certain configurations, Log4cxx may create new threads in order to do tasks(e.g. network comms, other async operations). On Linux/POSIX systems, this can lead to undesirable signal delivery, as signals can be delivered to any thread in the process. This can be most clearly seen if your application uses the <a href="https://man7.org/linux/man-pages/man3/sigwait.3.html">sigwait(3)</a> system call, as the thread that calls sigwait may not be the thread that actually gets the signal. By default, Log4cxx configures itself to block all signals to new threads that it creates on Linux/POSIX systems. See the <a class="el" href="threading.html#configuring">section on configuring</a> for more details on how to configure.</p>
<p>There are three main ways to handle signals coming to your process. All of these ways of handling signals are supported by Log4cxx in order to provide flexibility to users of the library. These three ways are:</p>
<ol type="1">
<li>Write to a file descriptor in a signal handler, notifying your main event loop of a signal. If you use Qt, <a href="https://doc.qt.io/qt-5/unix-signals.html">their documentation</a> has information on this method of handling a signal.</li>
<li>(Linux-only) Use <a href="https://man7.org/linux/man-pages/man2/signalfd.2.html">signalfd(2)</a> to create a file descriptor that notifies you of a signal. This is a special case of (1).</li>
<li>Block signals in newly created threads, ensuring that signals can only be sent to threads of your choosing.</li>
</ol>
<p>If you need to use option #3(for example, because you are using sigwait), Log4cxx provides a mechanism for defining methods to be called at two main points in the lifecycle of a thread:</p>
<ol type="1">
<li>Just before the thread starts</li>
<li>Just after the thread starts</li>
</ol>
<p>These two points are intended to let client code determine how best to start threads. Log4cxx provides a basic implementation of these for POSIX in order to block signals to the new threads that it creates.</p>
<p>Once a new thread is created, there is also a callback function that lets client code do operations on the thread directly. A sample method in Log4cxx has a callback to name the thread in order to make debugging nicer.</p>
<p>In order to use these callback functions, use the <a class="el" href="classlog4cxx_1_1helpers_1_1ThreadUtility.html">ThreadUtility</a> class. You can configure the ThreadUtility class in several different ways by using the <a class="el" href="classlog4cxx_1_1helpers_1_1ThreadUtility.html#ad8d5f94e39e37447de00e3affee69dc0">ThreadUtility::configure</a> method with several pre-defined configurations. In the event that you need special signal handling, you can implement your own functions, and use the <a class="el" href="classlog4cxx_1_1helpers_1_1ThreadUtility.html#a30d776e789c7f38f8fc1342919b944b3">ThreadUtility::configureFuncs</a> method in order to customize exactly what happens.</p>
<h2><a class="anchor" id="configuring"></a>
Configuring Thread</h2>
<p>To tell Log4cxx what to do by default when starting a new thread, the enum <a class="el" href="namespacelog4cxx_1_1helpers.html#a84bb84c01710854af8519e70d8a548d4">ThreadConfigurationType</a> may be used to configure the library appropriately. By default, all signals on POSIX systems will be blocked to ensure that other threads do not get signals.</p>
<p>To change this default, a simple change to your configuration files may be done.</p>
<p>Example to disable the automatic signal blocking with XML configuration: </p><div class="fragment"><div class="line">&lt;log4j:configuration threadConfiguration=&quot;NoConfiguration&quot;&gt;</div>
<div class="line">...</div>
<div class="line">&lt;/log4j:configuration&gt;</div>
</div><!-- fragment --><p>Example to disable the automatic signal blocking with properties configuration: </p><div class="fragment"><div class="line">log4j.threadConfiguration=NoConfiguration</div>
</div><!-- fragment --> </div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.8.13-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="usage-overview.html">Usage</a></li>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="https://www.doxygen.nl/images/doxygen.png" alt="Doxygen"/></a> 1.9.6 on Mon Jul 24 2023 </li>
    <li class="center">
Copyright &copy; 2003-2023 <a href="https://www.apache.org/">Apache Software Foundation</a>. All Rights Reserved.  <a href="https://privacy.apache.org/policies/privacy-policy-public.html">Privacy Policy</a><br/>
Apache Logging, Apache Log4j, Log4j, Apache, the Apache feather logo, and the Apache Logging project logo are trademarks of The Apache Software Foundation.<br/>
    </li>
  </ul>
</div>
</body>
</html>
