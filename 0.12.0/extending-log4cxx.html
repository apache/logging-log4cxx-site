<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Apache log4cxx: Extending Log4cxx</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="customdoxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Apache log4cxx
   &#160;<span id="projectnumber">Version 0.12.0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('extending-log4cxx.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Extending Log4cxx </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>Sometimes, you may want to extend <a class="el" href="namespacelog4cxx.html">log4cxx</a>, for example by creating a new appender to write out data in a new format. The following guide shows how you can extend <a class="el" href="namespacelog4cxx.html">log4cxx</a> in order to add a new appender.</p>
<p>The full sample application can be found in the src/examples/cpp directory.</p>
<p>The first thing for our example is to create a class that extends <a class="el" href="classlog4cxx_1_1AppenderSkeleton.html" title="Implementation base class for all appenders. ">log4cxx.AppenderSkeleton</a> so that we don't need to implement all of the virtual methods that are defined in <a class="el" href="classlog4cxx_1_1Appender.html" title="Implement this interface for your own strategies for outputting log statements. ">log4cxx.Appender</a>:</p>
<div class="fragment"><div class="line"><span class="keyword">namespace </span><a class="code" href="namespacelog4cxx.html">log4cxx</a> {</div><div class="line"></div><div class="line"><span class="keyword">class </span>NullWriterAppender : <span class="keyword">public</span> <a class="code" href="classlog4cxx_1_1AppenderSkeleton.html">log4cxx::AppenderSkeleton</a> {</div><div class="line">};</div><div class="line"></div><div class="line">}</div></div><!-- fragment --><p>Next, we need to add in a few macros in order to properly register our new appender with <a class="el" href="namespacelog4cxx.html">log4cxx</a>:</p>
<div class="fragment"><div class="line"><span class="keyword">namespace </span><a class="code" href="namespacelog4cxx.html">log4cxx</a> {</div><div class="line"></div><div class="line"><span class="keyword">class </span>NullWriterAppender : <span class="keyword">public</span> <a class="code" href="classlog4cxx_1_1AppenderSkeleton.html">log4cxx::AppenderSkeleton</a> {</div><div class="line"><span class="keyword">public</span>:</div><div class="line">    <a class="code" href="object_8h.html#a9e129ec12609d98bb2a10d15b46709ba">DECLARE_LOG4CXX_OBJECT</a>(NullWriterAppender)</div><div class="line">    <a class="code" href="object_8h.html#ac8ff8f70159e03fe7d8c4aa743cc9cda">BEGIN_LOG4CXX_CAST_MAP</a>()</div><div class="line">    <a class="code" href="object_8h.html#a642180530328ec0378468edda5bc94e2">LOG4CXX_CAST_ENTRY</a>(NullWriterAppender)</div><div class="line">    <a class="code" href="object_8h.html#ab14dc1a75d63a11359c8861a59786abc">LOG4CXX_CAST_ENTRY_CHAIN</a>(AppenderSkeleton)</div><div class="line">    <a class="code" href="object_8h.html#a917a7d053853b1ffdf45a3d91aeca4f1">END_LOG4CXX_CAST_MAP</a>()</div><div class="line"></div><div class="line">};</div><div class="line"></div><div class="line"><a class="code" href="object_8h.html#a7407bf6e747dc0c5db5208a4ae4a07e6">IMPLEMENT_LOG4CXX_OBJECT</a>(NullWriterAppender)</div><div class="line"></div><div class="line">}</div></div><!-- fragment --><p>These macros tell <a class="el" href="namespacelog4cxx.html">log4cxx</a> what the name of our class is, as well as giving <a class="el" href="namespacelog4cxx.html">log4cxx</a> a way of instansiating our class. Without these macros, the custom class will not work.</p>
<p>Now, let's add some basic functionality to our class. As the name of our class implies, we are going to do nothing with our appender here, as this is just an example. To that end, we need to implement the following:</p><ol type="1">
<li>Default constructor</li>
<li><code>close</code> method</li>
<li><code>requiresLayout</code> method</li>
<li><code>append</code> method, which does the actual writing of the log event</li>
<li><code>activateOptions</code>, which causes the class to reconfigure itself</li>
<li><code>setOption</code>, which gets called whenever we get an option in a config file</li>
</ol>
<p>These are basically stub methods, with a few comments on their use:</p>
<div class="fragment"><div class="line">NullWriterAppender(){}</div><div class="line"></div><div class="line"><span class="keyword">virtual</span> <span class="keywordtype">void</span> close(){}</div><div class="line"></div><div class="line"><span class="keyword">virtual</span> <span class="keywordtype">bool</span> requiresLayout()<span class="keyword"> const </span>{</div><div class="line">    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keyword">virtual</span> <span class="keywordtype">void</span> append(<span class="keyword">const</span> <a class="code" href="namespacelog4cxx_1_1spi.html#aae6992e1b33222c26bdc1173b6aedc6c">spi::LoggingEventPtr</a>&amp; event, <a class="code" href="classlog4cxx_1_1helpers_1_1Pool.html">log4cxx::helpers::Pool</a>&amp; p){</div><div class="line">    <span class="comment">// This gets called whenever there is a valid event for our appender.</span></div><div class="line">}</div><div class="line"></div><div class="line"><span class="keyword">virtual</span> <span class="keywordtype">void</span> activateOptions(<a class="code" href="classlog4cxx_1_1helpers_1_1Pool.html">log4cxx::helpers::Pool</a>&amp; <span class="comment">/* pool */</span>) {</div><div class="line">    <span class="comment">// Given all of our options, do something useful(e.g. open a file)</span></div><div class="line">}</div><div class="line"></div><div class="line"><span class="keyword">virtual</span> <span class="keywordtype">void</span> setOption(<span class="keyword">const</span> <a class="code" href="namespacelog4cxx.html#aa2308ed05fef2a1366066cb38b177e94">LogString</a>&amp; option, <span class="keyword">const</span> <a class="code" href="namespacelog4cxx.html#aa2308ed05fef2a1366066cb38b177e94">LogString</a>&amp; value){</div><div class="line">    <span class="keywordflow">if</span> (helpers::StringHelper::equalsIgnoreCase(option,</div><div class="line">           LOG4CXX_STR(<span class="stringliteral">&quot;SOMEVALUE&quot;</span>), LOG4CXX_STR(<span class="stringliteral">&quot;somevalue&quot;</span>))){</div><div class="line">        <span class="comment">// Do something with the &#39;value&#39; here.</span></div><div class="line">    }</div><div class="line">}</div></div><!-- fragment --><p>At this point, we now have a fully functioning(if useless) custom appender. We can now refer to this appender in our configuration file like so:</p>
<div class="fragment"><div class="line">&lt;?<span class="keyword">xml</span> <span class="keyword">version</span>=<span class="stringliteral">&quot;1.0&quot;</span> <span class="keyword">encoding</span>=<span class="stringliteral">&quot;UTF-8&quot;</span> ?&gt;</div><div class="line">&lt;<span class="keywordtype">log4j:configuration</span> <span class="keyword">xmlns:log4j</span>=<span class="stringliteral">&quot;http://jakarta.apache.org/log4j/&quot;</span>&gt;</div><div class="line">  &lt;<span class="keywordtype">appender</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;ConsoleAppender&quot;</span> <span class="keyword">class</span>=<span class="stringliteral">&quot;org.apache.log4j.ConsoleAppender&quot;</span>&gt;</div><div class="line">    &lt;<span class="keywordtype">param</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;Target&quot;</span> <span class="keyword">value</span>=<span class="stringliteral">&quot;System.out&quot;</span>/&gt;</div><div class="line">    &lt;<span class="keywordtype">layout</span> <span class="keyword">class</span>=<span class="stringliteral">&quot;org.apache.log4j.PatternLayout&quot;</span>&gt;</div><div class="line">      &lt;<span class="keywordtype">param</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;ConversionPattern&quot;</span> <span class="keyword">value</span>=<span class="stringliteral">&quot;[%d{yyyy-MM-dd HH:mm:ss}] %c %-5p - %m%n&quot;</span>/&gt;</div><div class="line">    &lt;/<span class="keywordtype">layout</span>&gt;</div><div class="line">  &lt;/<span class="keywordtype">appender</span>&gt;</div><div class="line"></div><div class="line">  &lt;<span class="keywordtype">appender</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;NullAppender&quot;</span> <span class="keyword">class</span>=<span class="stringliteral">&quot;NullWriterAppender&quot;</span>&gt;</div><div class="line">    &lt;<span class="keywordtype">param</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;SomeValue&quot;</span> <span class="keyword">value</span>=<span class="stringliteral">&quot;Nothing&quot;</span>/&gt;</div><div class="line">  &lt;/<span class="keywordtype">appender</span>&gt;</div><div class="line"></div><div class="line">  &lt;<span class="keywordtype">root</span>&gt;</div><div class="line">     &lt;<span class="keywordtype">priority</span> <span class="keyword">value</span>=<span class="stringliteral">&quot;info&quot;</span> /&gt;</div><div class="line">     &lt;<span class="keywordtype">appender-ref</span> <span class="keyword">ref</span>=<span class="stringliteral">&quot;ConsoleAppender&quot;</span>/&gt;</div><div class="line">  &lt;/<span class="keywordtype">root</span>&gt;</div><div class="line"></div><div class="line">  &lt;<span class="keywordtype">logger</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;NullLogger&quot;</span> <span class="keyword">additivity</span>=<span class="stringliteral">&quot;false&quot;</span>&gt;</div><div class="line">     &lt;<span class="keywordtype">appender-ref</span> <span class="keyword">ref</span>=<span class="stringliteral">&quot;NullAppender&quot;</span>/&gt;</div><div class="line">  &lt;/<span class="keywordtype">logger</span>&gt;</div><div class="line">&lt;/<span class="keywordtype">log4j:configuration</span>&gt;</div></div><!-- fragment --><p>When <a class="el" href="namespacelog4cxx.html">log4cxx</a> is configured, any messages that go to the <code>NullLogger</code> will then be forwarded on to the <code>NullWriterAppender</code>.</p>
<p>This same technique can be used to add new classes of many different kinds to <a class="el" href="namespacelog4cxx.html">log4cxx</a>, including(but not limited to):</p><ul>
<li><a class="el" href="classlog4cxx_1_1Appender.html">Appenders</a></li>
<li><a class="el" href="classlog4cxx_1_1Layout.html">Layouts</a></li>
<li><a class="el" href="classlog4cxx_1_1spi_1_1Filter.html">Filters</a> </li>
</ul>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.8.13-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="usage-overview.html">Usage</a></li>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.13 </li>
    <li class="center">
Copyright &copy; 2003-2021 <a href="https://www.apache.org/">Apache Software Foundation</a>. All Rights Reserved. <br/>
Apache Logging, Apache Log4j, Log4j, Apache, the Apache feather logo, and the Apache Logging project logo are trademarks of The Apache Software Foundation.
    </li>
  </ul>
</div>
</body>
</html>
